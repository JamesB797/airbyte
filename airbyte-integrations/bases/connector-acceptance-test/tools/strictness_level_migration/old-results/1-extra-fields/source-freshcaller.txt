../../../../connectors/source-freshcaller/acceptance-test-config.yml
/Users/ella/airbytehq/airbyte/airbyte-integrations/connectors/source-freshcaller
============================= test session starts ==============================
platform linux -- Python 3.9.11, pytest-6.2.5, py-1.11.0, pluggy-1.0.0
rootdir: /test_input
plugins: timeout-1.4.2, hypothesis-6.54.6, requests-mock-1.9.3, cov-3.0.0, sugar-0.9.6, mock-3.6.1
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
collected 37 items / 35 deselected / 2 selected

../../test_input/test_core.py F                                          [ 50%]
../../test_input/test_incremental.py .                                   [100%]


=================================== FAILURES ===================================
_______________________ TestBasicRead.test_read[inputs0] _______________________

self = <connector_acceptance_test.tests.test_core.TestBasicRead object at 0xffffb1543ac0>
connector_config = SecretDict(******)
configured_catalog = ConfiguredAirbyteCatalog(streams=[ConfiguredAirbyteStream(stream=AirbyteStream(name='users', json_schema={'$schema': '...l_refresh'>, cursor_field=None, destination_sync_mode=<DestinationSyncMode.overwrite: 'overwrite'>, primary_key=None)])
expect_records_config = None, should_validate_schema = True
should_validate_data_points = False, should_fail_on_extra_columns = True
empty_streams = {EmptyStreamConfiguration(name='teams', bypass_reason=None)}
ignored_fields = {}, expected_records_by_stream = {}
docker_runner = <connector_acceptance_test.utils.connector_runner.ConnectorRunner object at 0xffffb15d38b0>
detailed_logger = <Logger detailed_logger /test_input/acceptance_tests_logs/test_core.py__TestBasicRead__test_read[inputs0].txt (DEBUG)>

    def test_read(
        self,
        connector_config,
        configured_catalog,
        expect_records_config: ExpectedRecordsConfig,
        should_validate_schema: Boolean,
        should_validate_data_points: Boolean,
        should_fail_on_extra_columns: Boolean,
        empty_streams: Set[EmptyStreamConfiguration],
        ignored_fields: Optional[Mapping[str, List[IgnoredFieldsConfiguration]]],
        expected_records_by_stream: MutableMapping[str, List[MutableMapping]],
        docker_runner: ConnectorRunner,
        detailed_logger,
    ):
        output = docker_runner.call_read(connector_config, configured_catalog)
        records = [message.record for message in filter_output(output, Type.RECORD)]
    
        assert records, "At least one record should be read using provided catalog"
    
        if should_validate_schema:  # TODO Conditional logic
>           self._validate_schema(
                records=records, configured_catalog=configured_catalog, fail_on_extra_columns=should_fail_on_extra_columns
            )

connector_acceptance_test/tests/test_core.py:823: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

records = [AirbyteRecordMessage(namespace=None, stream='users', data={'id': 756472, 'name': 'Airbyte Team', 'email': 'integratio...022-05-05T02:34:57.789-07:00', 'updated_time': '2022-05-05T02:34:58.405-07:00', 'tags': []}, emitted_at=1679405056104)]
configured_catalog = ConfiguredAirbyteCatalog(streams=[ConfiguredAirbyteStream(stream=AirbyteStream(name='users', json_schema={'$schema': '...l_refresh'>, cursor_field=None, destination_sync_mode=<DestinationSyncMode.overwrite: 'overwrite'>, primary_key=None)])
fail_on_extra_columns = True

    @staticmethod
    def _validate_schema(records: List[AirbyteRecordMessage], configured_catalog: ConfiguredAirbyteCatalog, fail_on_extra_columns: Boolean):
        """
        Check if data type and structure in records matches the one in json_schema of the stream in catalog
        """
        TestBasicRead._validate_records_structure(records, configured_catalog)
        bar = "-" * 80
        streams_errors = verify_records_schema(records, configured_catalog, fail_on_extra_columns)
        for stream_name, errors in streams_errors.items():
            errors = map(str, errors.values())
            str_errors = f"\n{bar}\n".join(errors)
            logging.error(f"\nThe {stream_name} stream has the following schema errors:\n{str_errors}")
    
        if streams_errors:
>           pytest.fail(f"Please check your json_schema in selected streams {tuple(streams_errors.keys())}.")
E           Failed: Please check your json_schema in selected streams ('calls',).

connector_acceptance_test/tests/test_core.py:665: Failed
---------------------------- Captured stdout setup -----------------------------
{"type": "LOG", "log": {"level": "WARN", "message": "The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format."}}
------------------------------ Captured log setup ------------------------------
WARNING  root:config.py:282 The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format.
----------------------------- Captured stdout call -----------------------------
{"type": "LOG", "log": {"level": "ERROR", "message": "\nThe calls stream has the following schema errors:\nAdditional properties are not allowed ('parallel_call_groups', 'recording_to_redact' were unexpected)\n\nFailed validating 'additionalProperties' in schema:\n    {'$schema': 'http://json-schema.org/draft-04/schema#',\n     'additionalProperties': False,\n     'properties': {'assigned_agent_id': {'type': ['integer', 'null']},\n                    'assigned_agent_name': {'type': ['string', 'null']},\n                    'assigned_call_queue_id': {'type': ['integer', 'null']},\n                    'assigned_call_queue_name': {'type': ['string',\n                                                          'null']},\n                    'assigned_ivr_id': {'type': ['integer', 'null']},\n                    'assigned_ivr_name': {'type': ['string', 'null']},\n                    'assigned_team_id': {'type': ['integer', 'null']},\n                    'assigned_team_name': {'type': ['string', 'null']},\n                    'bill_duration': {'type': ['number', 'null']},\n                    'bill_duration_unit': {'type': ['string', 'null']},\n                    'call_notes': {'type': ['string', 'null']},\n                    'created_time': {'format': 'date-time',\n                                     'type': ['string', 'null']},\n                    'direction': {'type': ['string', 'null']},\n                    'id': {'type': ['integer', 'null']},\n                    'integrated_resources': {'items': {'properties': {'id': {'type': ['string',\n                                                                                      'null']},\n                                                                      'integration_name': {'type': ['string',\n                                                                                                    'null']},\n                                                                      'type': {'type': ['string',\n                                                                                        'null']}},\n                                                       'type': 'object'},\n                                             'type': ['array', 'null']},\n                    'parent_call_id': {'type': ['integer', 'null']},\n                    'participants': {'items': {'properties': {'call_id': {'type': ['integer',\n                                                                                   'null']},\n                                                              'call_status': {'type': ['integer',\n                                                                                       'null']},\n                                                              'caller_id': {'type': ['integer',\n                                                                                     'null']},\n                                                              'caller_name': {'type': ['string',\n                                                                                       'null']},\n                                                              'caller_number': {'type': ['string',\n                                                                                         'null']},\n                                                              'connection_type': {'type': ['number',\n                                                                                           'null']},\n                                                              'cost': {'type': ['number',\n                                                                                'null']},\n                                                              'cost_unit': {'type': ['string',\n                                                                                     'null']},\n                                                              'created_time': {'format': 'date-time',\n                                                                               'type': ['string',\n                                                                                        'null']},\n                                                              'duration': {'type': ['integer',\n                                                                                    'null']},\n                                                              'duration_unit': {'type': ['string',\n                                                                                         'null']},\n                                                              'enqueued_time': {'type': ['string',\n                                                                                         'null']},\n                                                              'id': {'type': ['integer',\n                                                                              'null']},\n                                                              'participant_id': {'type': ['integer',\n                                                                                          'null']},\n                                                              'participant_type': {'type': ['string',\n                                                                                            'null']},\n                                                              'updated_time': {'format': 'date-time',\n                                                                               'type': ['string',\n                                                                                        'null']}},\n                                               'type': 'object'},\n                                     'type': ['array', 'null']},\n                    'phone_number': {'type': ['string', 'null']},\n                    'phone_number_id': {'type': ['integer', 'null']},\n                    'recording': {'properties': {'duration': {'type': ['number',\n                                                                       'null']},\n                                                 'duration_unit': {'type': ['string',\n                                                                            'null']},\n                                                 'id': {'type': ['integer',\n                                                                 'null']},\n                                                 'transcription_url': {'type': ['string',\n                                                                                'null']},\n                                                 'url': {'type': ['string',\n                                                                  'null']}},\n                                  'type': ['object', 'null']},\n                    'root_call_id': {'type': ['integer', 'null']},\n                    'updated_time': {'format': 'date-time',\n                                     'type': ['string', 'null']}},\n     'type': 'object'}\n\nOn instance:\n    {'assigned_agent_id': None,\n     'assigned_agent_name': None,\n     'assigned_call_queue_id': 418164,\n     'assigned_call_queue_name': 'Global Queue',\n     'assigned_ivr_id': None,\n     'assigned_ivr_name': None,\n     'assigned_team_id': None,\n     'assigned_team_name': None,\n     'bill_duration': None,\n     'bill_duration_unit': 'seconds',\n     'call_notes': None,\n     'created_time': '2022-05-05T02:34:57.761-07:00',\n     'direction': 'outgoing',\n     'id': 135240607,\n     'integrated_resources': [],\n     'parallel_call_groups': [],\n     'parent_call_id': None,\n     'participants': [{'call_id': 135240607,\n                       'call_status': 10,\n                       'caller_id': 41372880,\n                       'caller_name': 'Sales',\n                       'caller_number': '+19163797474',\n                       'connection_type': 0,\n                       'cost': None,\n                       'cost_unit': 'usd',\n                       'created_time': '2022-05-05T02:34:57.791-07:00',\n                       'duration': None,\n                       'duration_unit': 'seconds',\n                       'enqueued_time': None,\n                       'id': 135240533,\n                       'participant_id': 46952239,\n                       'participant_type': 'Customer',\n                       'updated_time': '2022-05-05T02:34:57.803-07:00'}],\n     'phone_number': None,\n     'phone_number_id': 0,\n     'recording': {'duration': 9,\n                   'duration_unit': 'seconds',\n                   'id': 69528224,\n                   'transcription_url': None,\n                   'url': 'https://airbyte-cloud.freshcaller.com/api/v1/calls/135240607/recording/69528224'},\n     'recording_to_redact': None,\n     'root_call_id': None,\n     'updated_time': '2022-05-05T02:34:57.761-07:00'}"}}
------------------------------ Captured log call -------------------------------
ERROR    root:test_core.py:662 
The calls stream has the following schema errors:
Additional properties are not allowed ('parallel_call_groups', 'recording_to_redact' were unexpected)

Failed validating 'additionalProperties' in schema:
    {'$schema': 'http://json-schema.org/draft-04/schema#',
     'additionalProperties': False,
     'properties': {'assigned_agent_id': {'type': ['integer', 'null']},
                    'assigned_agent_name': {'type': ['string', 'null']},
                    'assigned_call_queue_id': {'type': ['integer', 'null']},
                    'assigned_call_queue_name': {'type': ['string',
                                                          'null']},
                    'assigned_ivr_id': {'type': ['integer', 'null']},
                    'assigned_ivr_name': {'type': ['string', 'null']},
                    'assigned_team_id': {'type': ['integer', 'null']},
                    'assigned_team_name': {'type': ['string', 'null']},
                    'bill_duration': {'type': ['number', 'null']},
                    'bill_duration_unit': {'type': ['string', 'null']},
                    'call_notes': {'type': ['string', 'null']},
                    'created_time': {'format': 'date-time',
                                     'type': ['string', 'null']},
                    'direction': {'type': ['string', 'null']},
                    'id': {'type': ['integer', 'null']},
                    'integrated_resources': {'items': {'properties': {'id': {'type': ['string',
                                                                                      'null']},
                                                                      'integration_name': {'type': ['string',
                                                                                                    'null']},
                                                                      'type': {'type': ['string',
                                                                                        'null']}},
                                                       'type': 'object'},
                                             'type': ['array', 'null']},
                    'parent_call_id': {'type': ['integer', 'null']},
                    'participants': {'items': {'properties': {'call_id': {'type': ['integer',
                                                                                   'null']},
                                                              'call_status': {'type': ['integer',
                                                                                       'null']},
                                                              'caller_id': {'type': ['integer',
                                                                                     'null']},
                                                              'caller_name': {'type': ['string',
                                                                                       'null']},
                                                              'caller_number': {'type': ['string',
                                                                                         'null']},
                                                              'connection_type': {'type': ['number',
                                                                                           'null']},
                                                              'cost': {'type': ['number',
                                                                                'null']},
                                                              'cost_unit': {'type': ['string',
                                                                                     'null']},
                                                              'created_time': {'format': 'date-time',
                                                                               'type': ['string',
                                                                                        'null']},
                                                              'duration': {'type': ['integer',
                                                                                    'null']},
                                                              'duration_unit': {'type': ['string',
                                                                                         'null']},
                                                              'enqueued_time': {'type': ['string',
                                                                                         'null']},
                                                              'id': {'type': ['integer',
                                                                              'null']},
                                                              'participant_id': {'type': ['integer',
                                                                                          'null']},
                                                              'participant_type': {'type': ['string',
                                                                                            'null']},
                                                              'updated_time': {'format': 'date-time',
                                                                               'type': ['string',
                                                                                        'null']}},
                                               'type': 'object'},
                                     'type': ['array', 'null']},
                    'phone_number': {'type': ['string', 'null']},
                    'phone_number_id': {'type': ['integer', 'null']},
                    'recording': {'properties': {'duration': {'type': ['number',
                                                                       'null']},
                                                 'duration_unit': {'type': ['string',
                                                                            'null']},
                                                 'id': {'type': ['integer',
                                                                 'null']},
                                                 'transcription_url': {'type': ['string',
                                                                                'null']},
                                                 'url': {'type': ['string',
                                                                  'null']}},
                                  'type': ['object', 'null']},
                    'root_call_id': {'type': ['integer', 'null']},
                    'updated_time': {'format': 'date-time',
                                     'type': ['string', 'null']}},
     'type': 'object'}

On instance:
    {'assigned_agent_id': None,
     'assigned_agent_name': None,
     'assigned_call_queue_id': 418164,
     'assigned_call_queue_name': 'Global Queue',
     'assigned_ivr_id': None,
     'assigned_ivr_name': None,
     'assigned_team_id': None,
     'assigned_team_name': None,
     'bill_duration': None,
     'bill_duration_unit': 'seconds',
     'call_notes': None,
     'created_time': '2022-05-05T02:34:57.761-07:00',
     'direction': 'outgoing',
     'id': 135240607,
     'integrated_resources': [],
     'parallel_call_groups': [],
     'parent_call_id': None,
     'participants': [{'call_id': 135240607,
                       'call_status': 10,
                       'caller_id': 41372880,
                       'caller_name': 'Sales',
                       'caller_number': '+19163797474',
                       'connection_type': 0,
                       'cost': None,
                       'cost_unit': 'usd',
                       'created_time': '2022-05-05T02:34:57.791-07:00',
                       'duration': None,
                       'duration_unit': 'seconds',
                       'enqueued_time': None,
                       'id': 135240533,
                       'participant_id': 46952239,
                       'participant_type': 'Customer',
                       'updated_time': '2022-05-05T02:34:57.803-07:00'}],
     'phone_number': None,
     'phone_number_id': 0,
     'recording': {'duration': 9,
                   'duration_unit': 'seconds',
                   'id': 69528224,
                   'transcription_url': None,
                   'url': 'https://airbyte-cloud.freshcaller.com/api/v1/calls/135240607/recording/69528224'},
     'recording_to_redact': None,
     'root_call_id': None,
     'updated_time': '2022-05-05T02:34:57.761-07:00'}
=============================== warnings summary ===============================
connector_acceptance_test/config.py:282: 36 warnings
test_core.py: 1 warning
  /airbyte/connector_acceptance_test/connector_acceptance_test/config.py:282: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
    logging.warn("The acceptance-test-config.yml file is in a legacy format. Please migrate to the latest format.")

-- Docs: https://docs.pytest.org/en/stable/warnings.html
=========================== short test summary info ============================
FAILED ../../test_input/test_core.py::TestBasicRead::test_read[inputs0] - Fai...
===== 1 failed, 1 passed, 35 deselected, 37 warnings in 119.54s (0:01:59) ======
