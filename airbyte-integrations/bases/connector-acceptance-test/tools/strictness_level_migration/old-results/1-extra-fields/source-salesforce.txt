../../../../connectors/source-salesforce/acceptance-test-config.yml
/Users/ella/airbytehq/airbyte/airbyte-integrations/connectors/source-salesforce
============================= test session starts ==============================
platform linux -- Python 3.9.11, pytest-6.2.5, py-1.11.0, pluggy-1.0.0
rootdir: /test_input
plugins: timeout-1.4.2, hypothesis-6.54.6, requests-mock-1.9.3, cov-3.0.0, sugar-0.9.6, mock-3.6.1
collected 38 items / 36 deselected / 2 selected

../../test_input/test_core.py F                                          [ 50%]
../../test_input/test_incremental.py .                                   [100%]


=================================== FAILURES ===================================
_______________________ TestBasicRead.test_read[inputs0] _______________________

self = <connector_acceptance_test.tests.test_core.TestBasicRead object at 0xffff9b648ac0>
connector_config = SecretDict(******)
configured_catalog = ConfiguredAirbyteCatalog(streams=[ConfiguredAirbyteStream(stream=AirbyteStream(name='Account', json_schema={'$schema':... cursor_field=['SystemModstamp'], destination_sync_mode=<DestinationSyncMode.append: 'append'>, primary_key=[['Id']])])
expect_records_config = ExpectedRecordsConfig(bypass_reason=None, path=PosixPath('integration_tests/expected_records.jsonl'), extra_fields=False, exact_order=False, extra_records=True)
should_validate_schema = True, should_validate_data_points = False
should_fail_on_extra_columns = True
empty_streams = {EmptyStreamConfiguration(name='ActiveScratchOrg', bypass_reason='impossible to fill the stream with data because it i...a because it is an organic traffic'), EmptyStreamConfiguration(name='Describe', bypass_reason='Data is not permanent')}
ignored_fields = {}
expected_records_by_stream = defaultdict(<class 'list'>, {'Account': [{'attributes': {'type': 'Account', 'url': '/services/data/v52.0/sobjects/Acco...AA', 'Visibility': 'DefaultOff', 'Name': 'standard-CardPaymentMethod', 'SystemModstamp': '2021-11-08T16:16:00.000Z'}]})
docker_runner = <connector_acceptance_test.utils.connector_runner.ConnectorRunner object at 0xffff9b0b5700>
detailed_logger = <Logger detailed_logger /test_input/acceptance_tests_logs/test_core.py__TestBasicRead__test_read[inputs0].txt (DEBUG)>

    def test_read(
        self,
        connector_config,
        configured_catalog,
        expect_records_config: ExpectedRecordsConfig,
        should_validate_schema: Boolean,
        should_validate_data_points: Boolean,
        should_fail_on_extra_columns: Boolean,
        empty_streams: Set[EmptyStreamConfiguration],
        ignored_fields: Optional[Mapping[str, List[IgnoredFieldsConfiguration]]],
        expected_records_by_stream: MutableMapping[str, List[MutableMapping]],
        docker_runner: ConnectorRunner,
        detailed_logger,
    ):
        output = docker_runner.call_read(connector_config, configured_catalog)
        records = [message.record for message in filter_output(output, Type.RECORD)]
    
        assert records, "At least one record should be read using provided catalog"
    
        if should_validate_schema:  # TODO Conditional logic
>           self._validate_schema(
                records=records, configured_catalog=configured_catalog, fail_on_extra_columns=should_fail_on_extra_columns
            )

connector_acceptance_test/tests/test_core.py:823: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

records = [AirbyteRecordMessage(namespace=None, stream='Account', data={'attributes': {'type': 'Account', 'url': '/services/data...tunity__c': 'Yes', 'SLASerialNumber__c': '6654', 'SLAExpirationDate__c': '2021-05-19'}, emitted_at=1679409181898), ...]
configured_catalog = ConfiguredAirbyteCatalog(streams=[ConfiguredAirbyteStream(stream=AirbyteStream(name='Account', json_schema={'$schema':... cursor_field=['SystemModstamp'], destination_sync_mode=<DestinationSyncMode.append: 'append'>, primary_key=[['Id']])])
fail_on_extra_columns = True

    @staticmethod
    def _validate_schema(records: List[AirbyteRecordMessage], configured_catalog: ConfiguredAirbyteCatalog, fail_on_extra_columns: Boolean):
        """
        Check if data type and structure in records matches the one in json_schema of the stream in catalog
        """
        TestBasicRead._validate_records_structure(records, configured_catalog)
        bar = "-" * 80
        streams_errors = verify_records_schema(records, configured_catalog, fail_on_extra_columns)
        for stream_name, errors in streams_errors.items():
            errors = map(str, errors.values())
            str_errors = f"\n{bar}\n".join(errors)
            logging.error(f"\nThe {stream_name} stream has the following schema errors:\n{str_errors}")
    
        if streams_errors:
>           pytest.fail(f"Please check your json_schema in selected streams {tuple(streams_errors.keys())}.")
E           Failed: Please check your json_schema in selected streams ('Account',).

connector_acceptance_test/tests/test_core.py:665: Failed
---------------------------- Captured stdout setup -----------------------------
{"type": "LOG", "log": {"level": "WARN", "message": "The configured catalog was built with the discovered catalog from which the following empty streams were removed: ActiveScratchOrg, ActiveScratchOrgShare, ActiveScratchOrgHistory, ActiveScratchOrgFeed, Describe."}}
------------------------------ Captured log setup ------------------------------
WARNING  root:common.py:149 The configured catalog was built with the discovered catalog from which the following empty streams were removed: ActiveScratchOrg, ActiveScratchOrgShare, ActiveScratchOrgHistory, ActiveScratchOrgFeed, Describe.
----------------------------- Captured stdout call -----------------------------
{"type": "LOG", "log": {"level": "ERROR", "message": "\nThe Account stream has the following schema errors:\nAdditional properties are not allowed ('attributes' was unexpected)\n\nFailed validating 'additionalProperties' in schema:\n    {'$schema': 'http://json-schema.org/draft-07/schema#',\n     'additionalProperties': False,\n     'properties': {'AccountNumber': {'type': ['string', 'null']},\n                    'AccountSource': {'type': ['string', 'null']},\n                    'Active__c': {'type': ['string', 'null']},\n                    'AnnualRevenue': {'type': ['number', 'null']},\n                    'BillingAddress': {'properties': {'city': {'type': ['null',\n                                                                        'string']},\n                                                      'country': {'type': ['null',\n                                                                           'string']},\n                                                      'geocodeAccuracy': {'type': ['null',\n                                                                                   'string']},\n                                                      'latitude': {'type': ['null',\n                                                                            'number']},\n                                                      'longitude': {'type': ['null',\n                                                                             'number']},\n                                                      'postalCode': {'type': ['null',\n                                                                              'string']},\n                                                      'state': {'type': ['null',\n                                                                         'string']},\n                                                      'street': {'type': ['null',\n                                                                          'string']}},\n                                       'type': ['object', 'null']},\n                    'BillingCity': {'type': ['string', 'null']},\n                    'BillingCountry': {'type': ['string', 'null']},\n                    'BillingGeocodeAccuracy': {'type': ['string', 'null']},\n                    'BillingLatitude': {'type': ['number', 'null']},\n                    'BillingLongitude': {'type': ['number', 'null']},\n                    'BillingPostalCode': {'type': ['string', 'null']},\n                    'BillingState': {'type': ['string', 'null']},\n                    'BillingStreet': {'type': ['string', 'null']},\n                    'CleanStatus': {'type': ['string', 'null']},\n                    'CreatedById': {'type': ['string', 'null']},\n                    'CreatedDate': {'format': 'date-time',\n                                    'type': ['string', 'null']},\n                    'CustomerPriority__c': {'type': ['string', 'null']},\n                    'DandbCompanyId': {'type': ['string', 'null']},\n                    'Description': {'type': ['string', 'null']},\n                    'DunsNumber': {'type': ['string', 'null']},\n                    'Fax': {'type': ['string', 'null']},\n                    'Id': {'type': ['string', 'null']},\n                    'Industry': {'type': ['string', 'null']},\n                    'IsDeleted': {'type': ['boolean', 'null']},\n                    'Jigsaw': {'type': ['string', 'null']},\n                    'JigsawCompanyId': {'type': ['string', 'null']},\n                    'LastActivityDate': {'format': 'date',\n                                         'type': ['string', 'null']},\n                    'LastModifiedById': {'type': ['string', 'null']},\n                    'LastModifiedDate': {'format': 'date-time',\n                                         'type': ['string', 'null']},\n                    'LastReferencedDate': {'format': 'date-time',\n                                           'type': ['string', 'null']},\n                    'LastViewedDate': {'format': 'date-time',\n                                       'type': ['string', 'null']},\n                    'MasterRecordId': {'type': ['string', 'null']},\n                    'NaicsCode': {'type': ['string', 'null']},\n                    'NaicsDesc': {'type': ['string', 'null']},\n                    'Name': {'type': ['string', 'null']},\n                    'NumberOfEmployees': {'type': ['integer', 'null']},\n                    'NumberofLocations__c': {'type': ['number', 'null']},\n                    'OperatingHoursId': {'type': ['string', 'null']},\n                    'OwnerId': {'type': ['string', 'null']},\n                    'Ownership': {'type': ['string', 'null']},\n                    'ParentId': {'type': ['string', 'null']},\n                    'Phone': {'type': ['string', 'null']},\n                    'PhotoUrl': {'type': ['string', 'null']},\n                    'Rating': {'type': ['string', 'null']},\n                    'SLAExpirationDate__c': {'format': 'date',\n                                             'type': ['string', 'null']},\n                    'SLASerialNumber__c': {'type': ['string', 'null']},\n                    'SLA__c': {'type': ['string', 'null']},\n                    'ShippingAddress': {'properties': {'city': {'type': ['null',\n                                                                         'string']},\n                                                       'country': {'type': ['null',\n                                                                            'string']},\n                                                       'geocodeAccuracy': {'type': ['null',\n                                                                                    'string']},\n                                                       'latitude': {'type': ['null',\n                                                                             'number']},\n                                                       'longitude': {'type': ['null',\n                                                                              'number']},\n                                                       'postalCode': {'type': ['null',\n                                                                               'string']},\n                                                       'state': {'type': ['null',\n                                                                          'string']},\n                                                       'street': {'type': ['null',\n                                                                           'string']}},\n                                        'type': ['object', 'null']},\n                    'ShippingCity': {'type': ['string', 'null']},\n                    'ShippingCountry': {'type': ['string', 'null']},\n                    'ShippingGeocodeAccuracy': {'type': ['string', 'null']},\n                    'ShippingLatitude': {'type': ['number', 'null']},\n                    'ShippingLongitude': {'type': ['number', 'null']},\n                    'ShippingPostalCode': {'type': ['string', 'null']},\n                    'ShippingState': {'type': ['string', 'null']},\n                    'ShippingStreet': {'type': ['string', 'null']},\n                    'Sic': {'type': ['string', 'null']},\n                    'SicDesc': {'type': ['string', 'null']},\n                    'Site': {'type': ['string', 'null']},\n                    'SystemModstamp': {'format': 'date-time',\n                                       'type': ['string', 'null']},\n                    'TickerSymbol': {'type': ['string', 'null']},\n                    'Tradestyle': {'type': ['string', 'null']},\n                    'Type': {'type': ['string', 'null']},\n                    'UpsellOpportunity__c': {'type': ['string', 'null']},\n                    'Website': {'type': ['string', 'null']},\n                    'YearStarted': {'type': ['string', 'null']}},\n     'type': 'object'}\n\nOn instance:\n    {'AccountNumber': None,\n     'AccountSource': None,\n     'Active__c': None,\n     'AnnualRevenue': None,\n     'BillingAddress': None,\n     'BillingCity': None,\n     'BillingCountry': None,\n     'BillingGeocodeAccuracy': None,\n     'BillingLatitude': None,\n     'BillingLongitude': None,\n     'BillingPostalCode': None,\n     'BillingState': None,\n     'BillingStreet': None,\n     'CleanStatus': 'Pending',\n     'CreatedById': '0054W00000BZkk0QAD',\n     'CreatedDate': '2021-11-08T16:47:39.000+0000',\n     'CustomerPriority__c': None,\n     'DandbCompanyId': None,\n     'Description': None,\n     'DunsNumber': None,\n     'Fax': None,\n     'Id': '0014W00002f8U6zQAE',\n     'Industry': 'Engineering',\n     'IsDeleted': False,\n     'Jigsaw': None,\n     'JigsawCompanyId': None,\n     'LastActivityDate': '2021-12-20',\n     'LastModifiedById': '0054W00000BZkk0QAD',\n     'LastModifiedDate': '2021-11-08T16:47:39.000+0000',\n     'LastReferencedDate': '2023-03-02T08:00:47.000+0000',\n     'LastViewedDate': '2023-03-02T08:00:47.000+0000',\n     'MasterRecordId': None,\n     'NaicsCode': None,\n     'NaicsDesc': None,\n     'Name': 'Aiybyte Pardo',\n     'NumberOfEmployees': None,\n     'NumberofLocations__c': None,\n     'OperatingHoursId': None,\n     'OwnerId': '0054W00000BZkk0QAD',\n     'Ownership': None,\n     'ParentId': None,\n     'Phone': None,\n     'PhotoUrl': '/services/images/photo/0014W00002f8U6zQAE',\n     'Rating': 'Warm',\n     'SLAExpirationDate__c': None,\n     'SLASerialNumber__c': None,\n     'SLA__c': None,\n     'ShippingAddress': None,\n     'ShippingCity': None,\n     'ShippingCountry': None,\n     'ShippingGeocodeAccuracy': None,\n     'ShippingLatitude': None,\n     'ShippingLongitude': None,\n     'ShippingPostalCode': None,\n     'ShippingState': None,\n     'ShippingStreet': None,\n     'Sic': None,\n     'SicDesc': None,\n     'Site': None,\n     'SystemModstamp': '2021-12-21T00:31:58.000+0000',\n     'TickerSymbol': None,\n     'Tradestyle': None,\n     'Type': 'Prospect',\n     'UpsellOpportunity__c': None,\n     'Website': None,\n     'YearStarted': None,\n     'attributes': {'type': 'Account',\n                    'url': '/services/data/v52.0/sobjects/Account/0014W00002f8U6zQAE'}}"}}
------------------------------ Captured log call -------------------------------
ERROR    root:test_core.py:662 
The Account stream has the following schema errors:
Additional properties are not allowed ('attributes' was unexpected)

Failed validating 'additionalProperties' in schema:
    {'$schema': 'http://json-schema.org/draft-07/schema#',
     'additionalProperties': False,
     'properties': {'AccountNumber': {'type': ['string', 'null']},
                    'AccountSource': {'type': ['string', 'null']},
                    'Active__c': {'type': ['string', 'null']},
                    'AnnualRevenue': {'type': ['number', 'null']},
                    'BillingAddress': {'properties': {'city': {'type': ['null',
                                                                        'string']},
                                                      'country': {'type': ['null',
                                                                           'string']},
                                                      'geocodeAccuracy': {'type': ['null',
                                                                                   'string']},
                                                      'latitude': {'type': ['null',
                                                                            'number']},
                                                      'longitude': {'type': ['null',
                                                                             'number']},
                                                      'postalCode': {'type': ['null',
                                                                              'string']},
                                                      'state': {'type': ['null',
                                                                         'string']},
                                                      'street': {'type': ['null',
                                                                          'string']}},
                                       'type': ['object', 'null']},
                    'BillingCity': {'type': ['string', 'null']},
                    'BillingCountry': {'type': ['string', 'null']},
                    'BillingGeocodeAccuracy': {'type': ['string', 'null']},
                    'BillingLatitude': {'type': ['number', 'null']},
                    'BillingLongitude': {'type': ['number', 'null']},
                    'BillingPostalCode': {'type': ['string', 'null']},
                    'BillingState': {'type': ['string', 'null']},
                    'BillingStreet': {'type': ['string', 'null']},
                    'CleanStatus': {'type': ['string', 'null']},
                    'CreatedById': {'type': ['string', 'null']},
                    'CreatedDate': {'format': 'date-time',
                                    'type': ['string', 'null']},
                    'CustomerPriority__c': {'type': ['string', 'null']},
                    'DandbCompanyId': {'type': ['string', 'null']},
                    'Description': {'type': ['string', 'null']},
                    'DunsNumber': {'type': ['string', 'null']},
                    'Fax': {'type': ['string', 'null']},
                    'Id': {'type': ['string', 'null']},
                    'Industry': {'type': ['string', 'null']},
                    'IsDeleted': {'type': ['boolean', 'null']},
                    'Jigsaw': {'type': ['string', 'null']},
                    'JigsawCompanyId': {'type': ['string', 'null']},
                    'LastActivityDate': {'format': 'date',
                                         'type': ['string', 'null']},
                    'LastModifiedById': {'type': ['string', 'null']},
                    'LastModifiedDate': {'format': 'date-time',
                                         'type': ['string', 'null']},
                    'LastReferencedDate': {'format': 'date-time',
                                           'type': ['string', 'null']},
                    'LastViewedDate': {'format': 'date-time',
                                       'type': ['string', 'null']},
                    'MasterRecordId': {'type': ['string', 'null']},
                    'NaicsCode': {'type': ['string', 'null']},
                    'NaicsDesc': {'type': ['string', 'null']},
                    'Name': {'type': ['string', 'null']},
                    'NumberOfEmployees': {'type': ['integer', 'null']},
                    'NumberofLocations__c': {'type': ['number', 'null']},
                    'OperatingHoursId': {'type': ['string', 'null']},
                    'OwnerId': {'type': ['string', 'null']},
                    'Ownership': {'type': ['string', 'null']},
                    'ParentId': {'type': ['string', 'null']},
                    'Phone': {'type': ['string', 'null']},
                    'PhotoUrl': {'type': ['string', 'null']},
                    'Rating': {'type': ['string', 'null']},
                    'SLAExpirationDate__c': {'format': 'date',
                                             'type': ['string', 'null']},
                    'SLASerialNumber__c': {'type': ['string', 'null']},
                    'SLA__c': {'type': ['string', 'null']},
                    'ShippingAddress': {'properties': {'city': {'type': ['null',
                                                                         'string']},
                                                       'country': {'type': ['null',
                                                                            'string']},
                                                       'geocodeAccuracy': {'type': ['null',
                                                                                    'string']},
                                                       'latitude': {'type': ['null',
                                                                             'number']},
                                                       'longitude': {'type': ['null',
                                                                              'number']},
                                                       'postalCode': {'type': ['null',
                                                                               'string']},
                                                       'state': {'type': ['null',
                                                                          'string']},
                                                       'street': {'type': ['null',
                                                                           'string']}},
                                        'type': ['object', 'null']},
                    'ShippingCity': {'type': ['string', 'null']},
                    'ShippingCountry': {'type': ['string', 'null']},
                    'ShippingGeocodeAccuracy': {'type': ['string', 'null']},
                    'ShippingLatitude': {'type': ['number', 'null']},
                    'ShippingLongitude': {'type': ['number', 'null']},
                    'ShippingPostalCode': {'type': ['string', 'null']},
                    'ShippingState': {'type': ['string', 'null']},
                    'ShippingStreet': {'type': ['string', 'null']},
                    'Sic': {'type': ['string', 'null']},
                    'SicDesc': {'type': ['string', 'null']},
                    'Site': {'type': ['string', 'null']},
                    'SystemModstamp': {'format': 'date-time',
                                       'type': ['string', 'null']},
                    'TickerSymbol': {'type': ['string', 'null']},
                    'Tradestyle': {'type': ['string', 'null']},
                    'Type': {'type': ['string', 'null']},
                    'UpsellOpportunity__c': {'type': ['string', 'null']},
                    'Website': {'type': ['string', 'null']},
                    'YearStarted': {'type': ['string', 'null']}},
     'type': 'object'}

On instance:
    {'AccountNumber': None,
     'AccountSource': None,
     'Active__c': None,
     'AnnualRevenue': None,
     'BillingAddress': None,
     'BillingCity': None,
     'BillingCountry': None,
     'BillingGeocodeAccuracy': None,
     'BillingLatitude': None,
     'BillingLongitude': None,
     'BillingPostalCode': None,
     'BillingState': None,
     'BillingStreet': None,
     'CleanStatus': 'Pending',
     'CreatedById': '0054W00000BZkk0QAD',
     'CreatedDate': '2021-11-08T16:47:39.000+0000',
     'CustomerPriority__c': None,
     'DandbCompanyId': None,
     'Description': None,
     'DunsNumber': None,
     'Fax': None,
     'Id': '0014W00002f8U6zQAE',
     'Industry': 'Engineering',
     'IsDeleted': False,
     'Jigsaw': None,
     'JigsawCompanyId': None,
     'LastActivityDate': '2021-12-20',
     'LastModifiedById': '0054W00000BZkk0QAD',
     'LastModifiedDate': '2021-11-08T16:47:39.000+0000',
     'LastReferencedDate': '2023-03-02T08:00:47.000+0000',
     'LastViewedDate': '2023-03-02T08:00:47.000+0000',
     'MasterRecordId': None,
     'NaicsCode': None,
     'NaicsDesc': None,
     'Name': 'Aiybyte Pardo',
     'NumberOfEmployees': None,
     'NumberofLocations__c': None,
     'OperatingHoursId': None,
     'OwnerId': '0054W00000BZkk0QAD',
     'Ownership': None,
     'ParentId': None,
     'Phone': None,
     'PhotoUrl': '/services/images/photo/0014W00002f8U6zQAE',
     'Rating': 'Warm',
     'SLAExpirationDate__c': None,
     'SLASerialNumber__c': None,
     'SLA__c': None,
     'ShippingAddress': None,
     'ShippingCity': None,
     'ShippingCountry': None,
     'ShippingGeocodeAccuracy': None,
     'ShippingLatitude': None,
     'ShippingLongitude': None,
     'ShippingPostalCode': None,
     'ShippingState': None,
     'ShippingStreet': None,
     'Sic': None,
     'SicDesc': None,
     'Site': None,
     'SystemModstamp': '2021-12-21T00:31:58.000+0000',
     'TickerSymbol': None,
     'Tradestyle': None,
     'Type': 'Prospect',
     'UpsellOpportunity__c': None,
     'Website': None,
     'YearStarted': None,
     'attributes': {'type': 'Account',
                    'url': '/services/data/v52.0/sobjects/Account/0014W00002f8U6zQAE'}}
=========================== short test summary info ============================
FAILED ../../test_input/test_core.py::TestBasicRead::test_read[inputs0] - Fai...
============ 1 failed, 1 passed, 36 deselected in 536.88s (0:08:56) ============
