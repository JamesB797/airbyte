../../../../connectors/source-pinterest/acceptance-test-config.yml
/Users/ella/airbytehq/airbyte/airbyte-integrations/connectors/source-pinterest
============================= test session starts ==============================
platform linux -- Python 3.9.11, pytest-6.2.5, py-1.11.0, pluggy-1.0.0
rootdir: /test_input
plugins: timeout-1.4.2, hypothesis-6.54.6, requests-mock-1.9.3, cov-3.0.0, sugar-0.9.6, mock-3.6.1
collected 47 items / 45 deselected / 2 selected

../../test_input/test_core.py F                                          [ 50%]
../../test_input/test_incremental.py .                                   [100%]


=================================== FAILURES ===================================
_______________________ TestBasicRead.test_read[inputs0] _______________________

self = <connector_acceptance_test.tests.test_core.TestBasicRead object at 0xffff8e96f460>
connector_config = SecretDict(******)
configured_catalog = ConfiguredAirbyteCatalog(streams=[ConfiguredAirbyteStream(stream=AirbyteStream(name='ad_accounts', json_schema={'$sche...ull_refresh'>, cursor_field=None, destination_sync_mode=<DestinationSyncMode.append: 'append'>, primary_key=[['id']])])
expect_records_config = ExpectedRecordsConfig(bypass_reason=None, path=PosixPath('integration_tests/expected_records.jsonl'), extra_fields=False, exact_order=False, extra_records=True)
should_validate_schema = True, should_validate_data_points = False
should_fail_on_extra_columns = True
empty_streams = {EmptyStreamConfiguration(name='ad_analytics', bypass_reason='The stream could return 0 records, because of low rate-l...eamConfiguration(name='campaigns', bypass_reason='The stream could return 0 records, because of low rate-limits'), ...}
ignored_fields = {}
expected_records_by_stream = defaultdict(<class 'list'>, {'ad_accounts': [{'id': '549761668032', 'name': 'Airbyte', 'owner': {'username': 'integrat...3988523388559', 'created_at': '2021-06-08T09:37:30', 'description': 'Data Integration', 'dominant_color': '#cacafe'}]})
docker_runner = <connector_acceptance_test.utils.connector_runner.ConnectorRunner object at 0xffff8e9bcf70>
detailed_logger = <Logger detailed_logger /test_input/acceptance_tests_logs/test_core.py__TestBasicRead__test_read[inputs0].txt (DEBUG)>

    def test_read(
        self,
        connector_config,
        configured_catalog,
        expect_records_config: ExpectedRecordsConfig,
        should_validate_schema: Boolean,
        should_validate_data_points: Boolean,
        should_fail_on_extra_columns: Boolean,
        empty_streams: Set[EmptyStreamConfiguration],
        ignored_fields: Optional[Mapping[str, List[IgnoredFieldsConfiguration]]],
        expected_records_by_stream: MutableMapping[str, List[MutableMapping]],
        docker_runner: ConnectorRunner,
        detailed_logger,
    ):
        output = docker_runner.call_read(connector_config, configured_catalog)
        records = [message.record for message in filter_output(output, Type.RECORD)]
    
        assert records, "At least one record should be read using provided catalog"
    
        if should_validate_schema:  # TODO Conditional logic
>           self._validate_schema(
                records=records, configured_catalog=configured_catalog, fail_on_extra_columns=should_fail_on_extra_columns
            )

connector_acceptance_test/tests/test_core.py:823: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

records = [AirbyteRecordMessage(namespace=None, stream='ad_accounts', data={'id': '549761668032', 'name': 'Airbyte', 'owner': {'...t0375'}, 'privacy': 'PUBLIC', 'created_at': '2021-06-08T09:37:18', 'collaborator_count': 0}, emitted_at=1679408249989)]
configured_catalog = ConfiguredAirbyteCatalog(streams=[ConfiguredAirbyteStream(stream=AirbyteStream(name='ad_accounts', json_schema={'$sche...ull_refresh'>, cursor_field=None, destination_sync_mode=<DestinationSyncMode.append: 'append'>, primary_key=[['id']])])
fail_on_extra_columns = True

    @staticmethod
    def _validate_schema(records: List[AirbyteRecordMessage], configured_catalog: ConfiguredAirbyteCatalog, fail_on_extra_columns: Boolean):
        """
        Check if data type and structure in records matches the one in json_schema of the stream in catalog
        """
        TestBasicRead._validate_records_structure(records, configured_catalog)
        bar = "-" * 80
        streams_errors = verify_records_schema(records, configured_catalog, fail_on_extra_columns)
        for stream_name, errors in streams_errors.items():
            errors = map(str, errors.values())
            str_errors = f"\n{bar}\n".join(errors)
            logging.error(f"\nThe {stream_name} stream has the following schema errors:\n{str_errors}")
    
        if streams_errors:
>           pytest.fail(f"Please check your json_schema in selected streams {tuple(streams_errors.keys())}.")
E           Failed: Please check your json_schema in selected streams ('ad_accounts', 'board_pins', 'boards').

connector_acceptance_test/tests/test_core.py:665: Failed
---------------------------- Captured stdout setup -----------------------------
{"type": "LOG", "log": {"level": "WARN", "message": "The configured catalog was built with the discovered catalog from which the following empty streams were removed: ad_analytics, user_account_analytics, board_section_pins, board_sections, ad_groups, campaigns, ad_group_analytics, ads, campaign_analytics, ad_account_analytics."}}
------------------------------ Captured log setup ------------------------------
WARNING  root:common.py:149 The configured catalog was built with the discovered catalog from which the following empty streams were removed: ad_analytics, user_account_analytics, board_section_pins, board_sections, ad_groups, campaigns, ad_group_analytics, ads, campaign_analytics, ad_account_analytics.
----------------------------- Captured stdout call -----------------------------
{"type": "LOG", "log": {"level": "ERROR", "message": "\nThe ad_accounts stream has the following schema errors:\nAdditional properties are not allowed ('created_time', 'permissions', 'updated_time' were unexpected)\n\nFailed validating 'additionalProperties' in schema:\n    {'$schema': 'http://json-schema.org/draft-07/schema#',\n     'additionalProperties': False,\n     'properties': {'country': {'type': ['null', 'string']},\n                    'currency': {'type': ['null', 'string']},\n                    'id': {'type': ['null', 'string']},\n                    'name': {'type': ['null', 'string']},\n                    'owner': {'properties': {'username': {'type': ['null',\n                                                                   'string']}},\n                              'type': ['null', 'object']}},\n     'type': 'object'}\n\nOn instance:\n    {'country': 'US',\n     'created_time': 1603772920,\n     'currency': 'USD',\n     'id': '549761668032',\n     'name': 'Airbyte',\n     'owner': {'username': 'integrationtest0375'},\n     'permissions': ['OWNER'],\n     'updated_time': 1623173784}"}}
{"type": "LOG", "log": {"level": "ERROR", "message": "\nThe board_pins stream has the following schema errors:\nAdditional properties are not allowed ('parent_pin_id', 'dominant_color' were unexpected)\n\nFailed validating 'additionalProperties' in schema:\n    {'$schema': 'http://json-schema.org/draft-07/schema#',\n     'additionalProperties': False,\n     'properties': {'alt_text': {'type': ['null', 'string']},\n                    'board_id': {'type': ['null', 'string']},\n                    'board_owner': {'properties': {'username': {'type': ['null',\n                                                                         'string']}},\n                                    'type': ['null', 'object']},\n                    'board_section_id': {'type': ['null', 'string']},\n                    'created_at': {'type': ['null', 'string']},\n                    'description': {'type': ['null', 'string']},\n                    'id': {'type': ['null', 'string']},\n                    'link': {'type': ['null', 'string']},\n                    'media': {'properties': {'media_type': {'type': ['null',\n                                                                     'string']}},\n                              'type': ['null', 'object']},\n                    'title': {'type': ['null', 'string']}},\n     'type': 'object'}\n\nOn instance:\n    {'alt_text': None,\n     'board_id': '666743988523388559',\n     'board_owner': {'username': 'integrationtest0375'},\n     'board_section_id': '5195034916661798218',\n     'created_at': '2021-06-08T09:37:30',\n     'description': 'Data Integration',\n     'dominant_color': '#cacafe',\n     'id': '666743919837294988',\n     'link': 'http://airbyte.io/',\n     'media': {'images': {'1200x': {'height': 718,\n                                    'url': 'https://i.pinimg.com/1200x/c6/b6/0d/c6b60d6b5f2ec04db7748d35fb1a8004.jpg',\n                                    'width': 1200},\n                          '150x150': {'height': 150,\n                                      'url': 'https://i.pinimg.com/150x150/c6/b6/0d/c6b60d6b5f2ec04db7748d35fb1a8004.jpg',\n                                      'width': 150},\n                          '400x300': {'height': 300,\n                                      'url': 'https://i.pinimg.com/400x300/c6/b6/0d/c6b60d6b5f2ec04db7748d35fb1a8004.jpg',\n                                      'width': 400},\n                          '600x': {'height': 359,\n                                   'url': 'https://i.pinimg.com/600x/c6/b6/0d/c6b60d6b5f2ec04db7748d35fb1a8004.jpg',\n                                   'width': 600},\n                          'originals': {'height': 760,\n                                        'url': 'https://i.pinimg.com/originals/c6/b6/0d/c6b60d6b5f2ec04db7748d35fb1a8004.jpg',\n                                        'width': 1270}},\n               'media_type': 'image'},\n     'parent_pin_id': None,\n     'title': 'Airbyte'}"}}
{"type": "LOG", "log": {"level": "ERROR", "message": "\nThe boards stream has the following schema errors:\nAdditional properties are not allowed ('created_at', 'media', 'board_pins_modified_at', 'pin_count', 'collaborator_count', 'follower_count' were unexpected)\n\nFailed validating 'additionalProperties' in schema:\n    {'$schema': 'http://json-schema.org/draft-07/schema#',\n     'additionalProperties': False,\n     'properties': {'description': {'type': ['null', 'string']},\n                    'id': {'type': ['null', 'string']},\n                    'name': {'type': ['null', 'string']},\n                    'owner': {'properties': {'username': {'type': ['null',\n                                                                   'string']}},\n                              'type': 'object'},\n                    'privacy': {'type': ['null', 'string']}},\n     'type': 'object'}\n\nOn instance:\n    {'board_pins_modified_at': '2021-10-25T11:17:56.715000',\n     'collaborator_count': 0,\n     'created_at': '2021-06-08T09:37:18',\n     'description': '',\n     'follower_count': 2,\n     'id': '666743988523388559',\n     'media': {'image_cover_url': 'https://i.pinimg.com/400x300/c6/b6/0d/c6b60d6b5f2ec04db7748d35fb1a8004.jpg',\n               'pin_thumbnail_urls': []},\n     'name': 'business',\n     'owner': {'username': 'integrationtest0375'},\n     'pin_count': 1,\n     'privacy': 'PUBLIC'}"}}
------------------------------ Captured log call -------------------------------
ERROR    root:test_core.py:662 
The ad_accounts stream has the following schema errors:
Additional properties are not allowed ('created_time', 'permissions', 'updated_time' were unexpected)

Failed validating 'additionalProperties' in schema:
    {'$schema': 'http://json-schema.org/draft-07/schema#',
     'additionalProperties': False,
     'properties': {'country': {'type': ['null', 'string']},
                    'currency': {'type': ['null', 'string']},
                    'id': {'type': ['null', 'string']},
                    'name': {'type': ['null', 'string']},
                    'owner': {'properties': {'username': {'type': ['null',
                                                                   'string']}},
                              'type': ['null', 'object']}},
     'type': 'object'}

On instance:
    {'country': 'US',
     'created_time': 1603772920,
     'currency': 'USD',
     'id': '549761668032',
     'name': 'Airbyte',
     'owner': {'username': 'integrationtest0375'},
     'permissions': ['OWNER'],
     'updated_time': 1623173784}
ERROR    root:test_core.py:662 
The board_pins stream has the following schema errors:
Additional properties are not allowed ('parent_pin_id', 'dominant_color' were unexpected)

Failed validating 'additionalProperties' in schema:
    {'$schema': 'http://json-schema.org/draft-07/schema#',
     'additionalProperties': False,
     'properties': {'alt_text': {'type': ['null', 'string']},
                    'board_id': {'type': ['null', 'string']},
                    'board_owner': {'properties': {'username': {'type': ['null',
                                                                         'string']}},
                                    'type': ['null', 'object']},
                    'board_section_id': {'type': ['null', 'string']},
                    'created_at': {'type': ['null', 'string']},
                    'description': {'type': ['null', 'string']},
                    'id': {'type': ['null', 'string']},
                    'link': {'type': ['null', 'string']},
                    'media': {'properties': {'media_type': {'type': ['null',
                                                                     'string']}},
                              'type': ['null', 'object']},
                    'title': {'type': ['null', 'string']}},
     'type': 'object'}

On instance:
    {'alt_text': None,
     'board_id': '666743988523388559',
     'board_owner': {'username': 'integrationtest0375'},
     'board_section_id': '5195034916661798218',
     'created_at': '2021-06-08T09:37:30',
     'description': 'Data Integration',
     'dominant_color': '#cacafe',
     'id': '666743919837294988',
     'link': 'http://airbyte.io/',
     'media': {'images': {'1200x': {'height': 718,
                                    'url': 'https://i.pinimg.com/1200x/c6/b6/0d/c6b60d6b5f2ec04db7748d35fb1a8004.jpg',
                                    'width': 1200},
                          '150x150': {'height': 150,
                                      'url': 'https://i.pinimg.com/150x150/c6/b6/0d/c6b60d6b5f2ec04db7748d35fb1a8004.jpg',
                                      'width': 150},
                          '400x300': {'height': 300,
                                      'url': 'https://i.pinimg.com/400x300/c6/b6/0d/c6b60d6b5f2ec04db7748d35fb1a8004.jpg',
                                      'width': 400},
                          '600x': {'height': 359,
                                   'url': 'https://i.pinimg.com/600x/c6/b6/0d/c6b60d6b5f2ec04db7748d35fb1a8004.jpg',
                                   'width': 600},
                          'originals': {'height': 760,
                                        'url': 'https://i.pinimg.com/originals/c6/b6/0d/c6b60d6b5f2ec04db7748d35fb1a8004.jpg',
                                        'width': 1270}},
               'media_type': 'image'},
     'parent_pin_id': None,
     'title': 'Airbyte'}
ERROR    root:test_core.py:662 
The boards stream has the following schema errors:
Additional properties are not allowed ('created_at', 'media', 'board_pins_modified_at', 'pin_count', 'collaborator_count', 'follower_count' were unexpected)

Failed validating 'additionalProperties' in schema:
    {'$schema': 'http://json-schema.org/draft-07/schema#',
     'additionalProperties': False,
     'properties': {'description': {'type': ['null', 'string']},
                    'id': {'type': ['null', 'string']},
                    'name': {'type': ['null', 'string']},
                    'owner': {'properties': {'username': {'type': ['null',
                                                                   'string']}},
                              'type': 'object'},
                    'privacy': {'type': ['null', 'string']}},
     'type': 'object'}

On instance:
    {'board_pins_modified_at': '2021-10-25T11:17:56.715000',
     'collaborator_count': 0,
     'created_at': '2021-06-08T09:37:18',
     'description': '',
     'follower_count': 2,
     'id': '666743988523388559',
     'media': {'image_cover_url': 'https://i.pinimg.com/400x300/c6/b6/0d/c6b60d6b5f2ec04db7748d35fb1a8004.jpg',
               'pin_thumbnail_urls': []},
     'name': 'business',
     'owner': {'username': 'integrationtest0375'},
     'pin_count': 1,
     'privacy': 'PUBLIC'}
=========================== short test summary info ============================
FAILED ../../test_input/test_core.py::TestBasicRead::test_read[inputs0] - Fai...
============ 1 failed, 1 passed, 45 deselected in 172.79s (0:02:52) ============
